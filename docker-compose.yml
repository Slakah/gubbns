version: '2'
services:
  gubbns:
    build: .
    command: gubbns -Dcouchdb.default.host=couchdb
    expose:
      - "9000"
    ports:
      - "9000:9000"
    links:
      - couchdb:couchdb
  couchdb:
    build:
      dockerfile: Dockerfile-couchdb
      context: .
  dockup:
    image: slakah/dockup-gs
    volumes_from:
      - couchdb
    command: >
      gs://gubbns-backup/gubbns/
      /usr/local/var/lib/couchdb
      --cron-time '32 4 * * *'
      --backup-name gubbns
      --gc-key '${GCLOUD_GUBBNS_BACKUP_KEY}'
